{% extends "themes/"|add:THEME|add:"/base.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6">

    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Ubah Password</h5>
      </div>

      <div class="card-body">

        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}

        <form method="post">
  {% csrf_token %}

  <!-- OLD PASSWORD -->
  <div class="mb-3">
    <div class="input-group">
      {{ form.old_password }}
      <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('id_old_password')">
        ğŸ‘ï¸
      </button>
    </div>
    {{ form.old_password.errors }}
  </div>

  <!-- NEW PASSWORD -->
  <div class="mb-2">
    <div class="input-group">
      {{ form.new_password1 }}
      <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('id_new_password1')">
        ğŸ‘ï¸
      </button>
    </div>

    <!-- Strength meter -->
    <div class="progress mt-2">
      <div id="password-strength" class="progress-bar" style="width:0%"></div>
    </div>
    <small id="password-text" class="text-muted"></small>

    {{ form.new_password1.errors }}
  </div>

  <!-- CONFIRM PASSWORD -->
  <div class="mb-3">
    <div class="input-group">
      {{ form.new_password2 }}
      <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('id_new_password2')">
        ğŸ‘ï¸
      </button>
    </div>
    <small id="confirm-error" class="text-danger d-none">
    Password tidak sama
    </small>
    {{ form.new_password2.errors }}
  </div>

  <button class="btn btn-primary">Simpan Password</button>
</form>

      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function togglePassword(id) {
  const input = document.getElementById(id);
  if (!input) return;
  input.type = input.type === "password" ? "text" : "password";
}

// PASSWORD STRENGTH
document.addEventListener("DOMContentLoaded", function () {
  const passwordInput = document.getElementById("id_new_password1");
  const strengthBar = document.getElementById("password-strength");
  const strengthText = document.getElementById("password-text");

  if (!passwordInput) return;

  passwordInput.addEventListener("input", function () {
    const val = passwordInput.value;
    let strength = 0;

    if (val.length >= 8) strength++;
    if (/[A-Z]/.test(val)) strength++;
    if (/[0-9]/.test(val)) strength++;
    if (/[^A-Za-z0-9]/.test(val)) strength++;

    const percent = strength * 25;
    strengthBar.style.width = percent + "%";
    strengthBar.className = "progress-bar";

    if (strength <= 1) {
      strengthBar.classList.add("bg-danger");
      strengthText.innerText = "Password lemah";
    } else if (strength === 2) {
      strengthBar.classList.add("bg-warning");
      strengthText.innerText = "Password cukup";
    } else if (strength === 3) {
      strengthBar.classList.add("bg-info");
      strengthText.innerText = "Password kuat";
    } else {
      strengthBar.classList.add("bg-success");
      strengthText.innerText = "Password sangat kuat";
    }
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const pass1 = document.getElementById("id_new_password1");
  const pass2 = document.getElementById("id_new_password2");
  const errorText = document.getElementById("confirm-error");
  const submitBtn = document.getElementById("submit-btn");

  function checkMatch() {
    if (!pass1.value || !pass2.value) {
      errorText.classList.add("d-none");
      submitBtn.disabled = true;
      return;
    }

    if (pass1.value !== pass2.value) {
      errorText.classList.remove("d-none");
      submitBtn.disabled = true;
    } else {
      errorText.classList.add("d-none");
      submitBtn.disabled = false;
    }
  }

  pass1.addEventListener("input", checkMatch);
  pass2.addEventListener("input", checkMatch);
});
</script>

{% endblock %}

